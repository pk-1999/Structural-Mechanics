 ### 简介

本程序用于进行<font color = purple>**二维平面结构的静力分析**</font>，计算结构的位移、内力和反力等参数，绘制并输出结构的内力图。程序基于 Python 实现，使用 NumPy 库进行数值计算，并调用 matplotlib 库进行结果可视化。

### 使用方法

1. 请将`README.md`文档或`README.html`在原有文件目录下打开，以避免超链接失效（`README.md`已在VSCode环境中测试，窗口右上角可启用"预览编译器"，快捷键为`ctrl+K` `V`；`README.html`已在Chrome环境中测试）。
2. 确保您的设备能够正常运行 jupyter nootbook，下载程序文件 [`structure_analysis.ipynb`](structure_analysis.ipynb) 并保存到本地环境，本说明文档为该版本程序写作。否则请尝试使用[`structure_analysis.py`](structure_analysis.py)。
3. 准备输入数据文件 [`InputData1.txt`](InputData1.txt)，将其保存在程序同一文件目录下，确保文件格式符合要求（参见 [[#输入数据格式]] ）。
4. 运行程序，带有`*`标志的单元格为非必需运行块（主要为输入数据正确性目视检查代码）程序将读取输入数据并进行计算，程序将在同一文件目录下创建输出数据文件[`OutputData1.txt`](OutputData1.txt)。
5. 查看输出结果（参见 [[#输出结果格式]] ），包括位移、内力等信息，并可通过绘图功能可视化结果，内力图（$M$ [`Moment1.png`](Moment1.png), $F_Q$ [`Shear1.png`](Shear1.png), $F_N$ [`Axial1.png`](Axial1.png)将输出到同一目录下。
6. 如需更改输入数据，可以编辑 [`InputData1.txt`](InputData1.txt) 文件，并重启内核，重新运行程序。
7. 如需批处理文件，可通过创建数组并使用`NameIndex`变量遍历实现。

### 输入数据格式

- **静力分析**：输入文件第一行为静力分析参数，应为一个整数 `1`。

- **控制参数**：输入文件第二行为控制参数，应包含五个整数，依次表示单元数量、节点数量、全局自由度数量、节点荷载数量和单元荷载数量。

- **节点数据**：从第三行开始的 `NJoint` 行，每行包含两个浮点数和三个整数，依次表示节点的 x 坐标、y 坐标和全局自由度编码。[`InputData1.txt`](InputData1.txt)

- **单元数据**：接下来的 `NElem` 行，每行包含四个浮点数，依次表示单元的两个节点编号、EA 和 EI。

- **节点荷载数据**：接下来的 `NJLoad` 行，每行包含三个浮点数，依次表示节点编号、荷载类型和荷载值。

- **单元荷载数据**：接下来的 `NELoad` 行，每行包含四个浮点数，依次表示单元编号、荷载类型、位置和荷载值。


1. 本程序实现的计算并输出**端点内力值**的单元荷载类型

  |  | index | 类型    | 参数`pos`          | 参数`LodVal`      |
  | - | ----- | ----- | ---------------- | --------------- |
  |  | 1     | 垂直分布力 | 分布在左端点到距离左端点该距离内 | 大小$[kN/m]$，$\hat{\bar{y}}$方向为正      |
  |  | 2     | 垂直集中力 | 作用在距离左端点该距离处     | 大小$[kN]$，$\hat{\bar{y}}$方向为正        |
  |  | 3     | 集中弯矩  | 作用在距离左端点该距离处     | 大小$[kN\cdot m]$，逆时针为正 |


2. 本程序实现的计算并输出**内力图**的单元荷载类型

  |  | index | 类型    | 参数`pos`          | 参数`LodVal`      |
  | - | ----- | ----- | ---------------- | --------------- |
  | | 1     | 垂直分布力 | `pos=L`作用于整个单元   | 大小$[kN/m]$，$\hat{\bar{y}}$方向为正      |
  | | 2     | 垂直集中力 | `pos=L/2`作用于单元中点 | 大小$[kN]$，$\hat{\bar{y}}$方向为正        |
  | | 3     | 集中弯矩  | `pos=L/2`作用于单元中点 | 大小$[kN\cdot m]$，逆时针为正 |

3. 本程序支持的**结点荷载**

  | | LodDOF | 类型         | 参数`LodVal` |
  | - | ------ | ---------- | ---------- |
  | | 1      | 全局坐标x方向集中力 | 大小$[kN]$，$\hat{x}$方向为正   |
  | | 2      | 全局坐标y方向集中力 | 大小$[kN]$，$\hat{y}$方向为正   |

*[[#示例数据]]*


### 输出结果格式

- **结构信息**：输出文件第一行为结构信息，应包含两个整数，依次表示结构的编号和模型类型。

- **杆端位移**：输出文件第二行开始的 `NElem` 行，每行包含六个浮点数，依次表示在杆件<u>局部坐标系</u>下单元的两个节点的位移，其中正负号规定满足：$u$沿$\hat{\bar{x}}$为正，$v$沿$\hat{\bar{y}}$为正，$\theta$沿逆时针为正。

- **杆端内力**：接下来的 `NElem` 行，每行包含六个浮点数，依次表示在杆件<u>局部坐标系</u>下单元的两个节点的内力，其中的正负号规定满足：$F_N$沿$\hat{\bar{x}}$为正，$F_Q$沿$\hat{\bar{y}}$为正，$M$沿逆时针为正。

- **弯矩图**：画在受拉侧。

- **剪力图**：使杆顺时针旋转为正，图中橙色为正，蓝色为负。

- **轴力图**：杆件受拉为正，图中橙色为正，蓝色为负。

*[[#示例数据]]*

### 示例数据

<font color = purple>大作业中的题目作为示例数据 `InputData1.txt` ，及其对应的输出结果`OutputData1.txt`已包含在程序文件夹中，弯矩图、剪力图和轴力图也根据该示例绘制。</font>

### 注意事项

- 输入数据格式需严格按照要求，否则可能导致程序错误或无法正确计算。

- 输出结果仅包含静力分析的计算结果。

- 如有任何问题或建议，请联系开发者进行反馈。

### 实现逻辑

1. **数据读取和初始化：**
    - 程序首先读取给定路径下的数据文件，文件格式为文本文件，包含了结构的节点、单元、节点荷载和单元荷载数据。
    - 通过文件读取，提取出节点数目、单元数目、全局自由度数目、节点荷载数目和单元荷载数目等控制参数。
    - 针对每个节点和单元的数据行，程序依次读取并初始化对应的节点对象和单元对象。

2. **计算结构刚度矩阵$K$：**
    - 根据给定的节点和单元数据，程序按照有限元方法计算整体结构的刚度矩阵。
    - 首先根据单元杆件的几何形状和材料性质计算出每个单元的局部刚度矩阵。
    - 然后根据单元的局部坐标系和全局坐标系之间的转换关系，将局部刚度矩阵转换为全局刚度矩阵。
    - 最终将所有单元的全局刚度矩阵叠加得到整体结构的刚度矩阵。

3. **施加节点和单元荷载 ，计算整体总结点荷载向量$P$：**
    - 将从文件中读取的节点和单元荷载数据施加到结构上，形成整体结点荷载向量。
    - 根据节点和单元荷载数据的不同类型（分布力、集中力、集中力矩），利用锁住再放松思想，程序对单元荷载转换为单元等效结点载荷$P_E^{(i)}=-F_E^{(i)}$，并对位移自由度累加。

4. **求解位移向量$\Delta$：**
    - 利用$P=K\cdot \Delta$，通过解线性方程组，计算结构中各个节点的位移。

5. **计算单元杆端力$\bar{F^e}$：**
    - 根据已求得的位移向量和单元的局部刚度矩阵，计算各单元的杆端力。

6. **输出结果：**
    - 将位移向量和单元杆端力等结果输出至文件，以便后续分析和处理。
    - 通过可视化图形展示结构的位移、内力等状态，以便工程师进行更直观的分析和理解。

7. **绘图**：
	- 程序通过`DIVIDE`控制绘图精度（数值表示每根杆进行`DIVIDE`个点的插值）。
	- 首先根据已经得到的端点得到位移导致的内力的线性分布，进一步用叠加法绘制每一部分单元外力导致的内力分布。

### 开发者信息

[pk-yu](https://github.com/pk-1999)

### 版权信息

本程序未经授权不得用于商业目的。

### 参考信息

本程序框架设计参考《程序结构力学》袁驷老师编著。    
本说明文档借助Copilot生成，如有错漏，欢迎批评指正。
